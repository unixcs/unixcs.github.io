---
title: "Docker"
date: 2019-06-11
tags: ["Linux"]
---

### 0x00**å‰è¨€**
å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œæ„Ÿè§‰æ¯å¤©éƒ½åœ¨è™šåº¦å…‰é˜´ï¼Œè¦ç»™è‡ªå·±æŒ‡å®šä¸€ä¸ªå­¦ä¹ è®¡åˆ’ï¼Œè®©è‡ªå·±å¿™èµ·æ¥ï¼ï¼
è®°ä¸€ä¸‹æœ€è¿‘åˆšæ¥è§¦çš„dokerå§ï¼ŒæŠŠç¬”è®°çŸ¥è¯†ç‚¹æ±‡æ€»ä¸€ä¸‹ã€‚


  




### 0x01**Dcoker æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿ**





Dockerçš„æ€æƒ³æ¥è‡ªäº`é›†è£…ç®±`ï¼Œé›†è£…ç®±è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
åœ¨ä¸€è‰˜å¤§èˆ¹ä¸Šï¼Œå¯ä»¥æŠŠè´§ç‰©è§„æ•´çš„æ‘†æ”¾èµ·æ¥ã€‚
å¹¶ä¸”å„ç§å„æ ·çš„è´§ç‰©è¢«é›†è£…ç®±æ ‡å‡†åŒ–äº†ï¼Œé›†è£…ç®±å’Œé›†è£…ç®±ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“ã€‚
é‚£ä¹ˆæˆ‘å°±ä¸éœ€è¦ä¸“é—¨è¿é€æ°´æœçš„èˆ¹å’Œä¸“é—¨è¿é€åŒ–å­¦å“çš„èˆ¹äº†ã€‚
åªè¦è¿™äº›è´§ç‰©åœ¨é›†è£…ç®±é‡Œå°è£…çš„å¥½å¥½çš„ï¼Œé‚£æˆ‘å°±å¯ä»¥ç”¨ä¸€è‰˜å¤§èˆ¹æŠŠä»–ä»¬éƒ½è¿èµ°ã€‚







> 
è¿˜ä¸æ‡‚ä»€ä¹ˆæ˜¯dockerï¼Ÿé‚£å°±çœ‹çœ‹è¿™ä¸¤ä¸ªç”ŸåŠ¨å½¢è±¡é€šä¿—æ˜“æ‡‚çš„ä¾‹å­å§
[Case1](https://my.oschina.net/jamesview/blog/2994112)
[Case2](https://www.jianshu.com/p/8cccc39c9f1c) 











##### é•œåƒï¼ˆimageï¼‰å’Œå®¹å™¨ï¼ˆcontainerï¼‰è®²docker ä¹‹å‰å¿…é¡»è¦æçš„ä¸¤ä¸ªè¯ **é•œåƒ** and **å®¹å™¨**


é‚£ä¹ˆä»€ä¹ˆæ˜¯é•œåƒï¼Ÿä»€ä¹ˆåˆæ˜¯å®¹å™¨å‘¢ï¼Ÿ 


##### å®¹å™¨é€šä¿—æ¥è®²å®¹å™¨å°±æ˜¯è£…ä¸œè¥¿çš„ç®±å­ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸º **é›†è£…ç®±**
å®¹å™¨å¥½æ¯”è½¯ä»¶é›†è£…ç®±ï¼Œå®ƒå†…éƒ¨å¯ä»¥å®‰è£…ä»»ä½•è½¯ä»¶å’Œåº“æ–‡ä»¶ï¼Œåšä»»æ„çš„è¿è¡Œç¯å¢ƒé…ç½®ã€‚




- é•œåƒæ˜¯é™æ€çš„ã€‚

- ä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ã€‚



##### é•œåƒä½ å¯ä»¥æŠŠé•œåƒçœ‹æˆæ˜¯æˆ‘ä»¬ç”µè„‘çš„é‡Œé¢çš„ **è½¯ä»¶å®‰è£…åŒ…**
Dockerè¿è¡Œå®¹å™¨å‰éœ€è¦æœ¬åœ°å­˜åœ¨å¯¹åº”çš„é•œåƒï¼Œä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œ




- å®¹å™¨æ˜¯åŠ¨æ€çš„ã€‚

- é•œåƒå¯¹äºå®¹å™¨åªæ˜¯å¯è¯»çš„ã€‚










### 0x02**æ­å»ºdockerä¸»è¦æµç¨‹ï¼š**


**æ‰¾é•œåƒ(search) -&gt; ä¸‹é•œåƒ(pull) -&gt; æŸ¥çœ‹é•œåƒ(images) -&gt; é•œåƒä¸­åˆ›å»ºå®¹å™¨(run) -&gt; æŸ¥çœ‹å®¹å™¨(ps)**


---

æˆ‘ç”¨çš„æ˜¯centos7æ­å»ºçš„docker
æ£€æŸ¥centosç‰ˆæœ¬æ˜¯å¦æ”¯æŒdocker


1.æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ (æ˜¯å¦å¤§äº3.10)
`uname -r` 


2.å®‰è£…docker
`yum -y install docker`
å®‰è£…æœ€æ–°ç‰ˆæœ¬
`yum -y install docker-ce`
å®‰è£…å‡ºç°é—®é¢˜â€“&gt;[æ–‡ç« ](https://blog.csdn.net/xixiworld/article/details/71438794)


yum install  docker-ce- (æŒ‡å®šå®‰è£…ç‰ˆæœ¬) 


`systemctl start docker`     å¼€å¯docker
`systemctl enable docker`    å¼€æœºå¯åŠ¨
`docker version`             æŸ¥çœ‹dockerç‰ˆæœ¬å·


3.éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ


`docker run hello-world`


> 
åˆ°è¿™é‡Œå…¶å®dockerå·²ç»å®‰è£…å¥½äº†ï¼Œä½†ï¼å®‰è£…å¥½ä»…ä»…åªæ˜¯ç¬¬ä¸€æ­¥éª¤ï¼›
åé¢è¿˜è¦ä¸‹è½½æ‰€éœ€çš„é•œåƒæˆ–è€…ä½¿ç”¨dockerfileè‡ªè¡Œæ„å»ºdockeré•œåƒï¼›
æœ€åå†éƒ¨ç½²å®‰è£…ä½ çš„åº”ç”¨ç¨‹åºåˆ°dockerå®¹å™¨ä¸­ã€‚







### ä¸€. é•œåƒä¸‹è½½CentOS7 é•œåƒ
`docker pull centos`


**å®‰è£…æ—¶é‡åˆ°çš„é—®é¢˜**
x509: certificate has expired or is not yet validé”™è¯¯è§£å†³


è¿™ä¸ªé—®é¢˜åŸºæœ¬ä¸Šæ˜¯å› ä¸ºè¯ä¹¦å‡ºç°è¿‡æœŸå¯¼è‡´ã€‚


**è§£å†³åŠæ³•**
æŸ¥çœ‹è™šæ‹Ÿæœºå’Œè¿œç¨‹æœåŠ¡å™¨çš„æ—¶é—´æ˜¯å¦åŒæ­¥ï¼š
ğŸ‘‡ğŸ‘‡
`date`
è‹¥æ—¶é—´ä¸åŒæ­¥ï¼Œæ‰§è¡Œ
`ntpdate cn.pool.ntp.org`
è‹¥å®‰è£…å¤±è´¥ æ£€æŸ¥æ˜¯å¦å®‰è£…äº†ntpate
`yum install ntpdate -y` 


##### é•œåƒå‘½ä»¤1.æœç´¢é•œåƒ
docker search å…³é”®è¯


2.è·å–é•œåƒ
docker pull ä»“åº“åç§°[:tag]


3.æŸ¥çœ‹é•œåƒ
`docker images`         


4.åˆ é™¤é•œåƒ
`docker rmi [image id]`
`docker rmi [tag]`  //ä»“åº“å


> 
ä½¿ç”¨ **docker rmi [id]** å‘½ä»¤æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¯¥é•œåƒæ²¡æœ‰è¢«å®¹å™¨ä½¿ç”¨æ‰èƒ½è¿›è¡Œ;
åˆ é™¤æ—¶ç³»ç»Ÿä¼šå…ˆåˆ é™¤æ‰æŒ‡å‘è¯¥é•œåƒçš„æ‰€æœ‰æ ‡ç­¾ï¼Œç„¶ååˆ é™¤é•œåƒæœ¬èº«ã€‚




5.å­˜å‡ºé•œåƒå’Œè½½å…¥é•œåƒ


docker save -o å­˜å‚¨æ–‡ä»¶å å­˜å‚¨çš„é•œåƒ





### äºŒ.å®¹å™¨1.åˆ›å»ºå®¹å™¨
`docker create`
`docker run`        //åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨  


2.æŸ¥çœ‹å®¹å™¨
`docker ps`
`docker ps -a`             //    æŸ¥çœ‹æ‰€æœ‰docker


3.å¯åŠ¨/ç»ˆæ­¢å®¹å™¨
`docker start [names]`
`docker stop [names]`


4.åˆ é™¤å®¹å™¨     




- ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨
`docker rm [CONTAINER ID]`




- æ­£åœ¨è¿è¡Œçš„å®¹å™¨
`docker rm -f [CONTAINER ID]`






5.è¿›å…¥å®¹å™¨
`docker exec -it [name] bash`          è¿›å…¥å®¹å™¨
`docker run -i -t centos /bin/bash`     åˆ›å»ºcentos


> 
execæ˜¯è¿›å…¥å·²ç»å­˜åœ¨çš„å®¹å™¨ï¼Œrunæ˜¯åˆ›å»ºæ–°å®¹å™¨ 




5.é€€å‡ºå®¹å™¨
`ctrl+d` é€€å‡ºå®¹å™¨ä¸”å…³é—­


`ctrl+p+q` é€€å‡ºå®¹å™¨ä½†ä¸å…³é—­


`docker kill -s HUP [å®¹å™¨å]`


> 
HUP(1)æ˜¯è®©è¿›ç¨‹æŒ‚èµ·ï¼Œç¡çœ ;
kill (9)å…­äº²ä¸è®¤çš„æ€æ‰
term(15)æ­£å¸¸çš„é€€å‡ºè¿›ç¨‹









---

### 0x03docker logs errors and others


é‡åˆ°é—®é¢˜ã€è¿è¡Œä¸äº†ä¹‹ç±»çš„å…ˆçœ‹æ—¥å¿—æŠ¥é”™ä¿¡æ¯!




##### 1. Exited (1) é”™è¯¯è¿™ä¸ªæŠ¥é”™ä¿¡æ¯ æ˜¯æˆ‘åœ¨ä½¿ç”¨phpé•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ—¶å‡ºç°çš„ï¼Œå½“æ—¶åªçŸ¥é“å‚»ä¹ä¹çš„çš„å»ç™¾åº¦æœï¼Œä¸çŸ¥é“æŸ¥çœ‹docker logs æŠ¥é”™ï¼Œå¯¼è‡´èµ°äº†å¾ˆé•¿çš„å¼¯è·¯ï¼
é”™è¯¯åŸå› ï¼š phpçš„é…ç½®æ–‡ä»¶é‡Œ server è¢«æˆ‘æ‰“æˆäº†erver ï¼Œå‘ç°è¿™ä¸ªé”™è¯¯çš„æ—¶å€™ æˆ‘çœŸçš„æ˜¯æƒ³æŠŠè‡ªå·±æä¸€é¡¿(~~å¤åˆ¶ç²˜è´´éƒ½èƒ½é”™~~)


æ€»ç»“ï¼š    ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒï¼ï¼


**docker los å‘½ä»¤**







##### 2. é…ç½®æ²¡é—®é¢˜ï¼Œè®¿é—®æ­å»ºçš„nginxä¸æˆåŠŸé”™è¯¯åŸå› ï¼š


é‡å¯ä¸‹dockers
systemctl restart docker
é‡å¯å®¹å™¨
docker restart [name]


å†æ¬¡è®¿é—®
successï¼











---

---




### è¿›å…¥docker æ–¹æ³•

- **exec**
`docker exec [names] bash`




- **nsenter**






1 . æŸ¥çœ‹å®¹å™¨[id]çš„è¿›ç¨‹çš„PID
`docker inspect -f \{\{.State.Pid\}\} [CONTAINER ID]`


2 . ä½¿ç”¨pidè¿›å…¥å®¹å™¨
`nsenter --target $PID --mount --uts --ipc --net --pid`
$PIDä¸ºç¬¬ä¸€æ­¥æŸ¥è¯¢åˆ°çš„PID


[about nsenter install](https://blog.csdn.net/qq_39629343/article/details/80170164)






### dockerå¸è½½æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
`yum list installed | grep docker`


åˆ é™¤åŒ…
`yum -y remove docker-engine.x86_64`


---

æ¨èä¸¤ä¸ªdoker æ­å»º[nginx](https://www.runoob.com/docker/docker-install-nginx.html)ã€[php](https://www.runoob.com/docker/docker-install-php.html) ã€mysql çš„æ–‡ç« 


å‚è€ƒï¼š[https://blog.51cto.com/11134648/2160257](https://blog.51cto.com/11134648/2160257)
